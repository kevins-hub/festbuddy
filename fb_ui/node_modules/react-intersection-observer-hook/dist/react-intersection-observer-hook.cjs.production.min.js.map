{"version":3,"file":"react-intersection-observer-hook.cjs.production.min.js","sources":["../src/useIntersectionObserver.ts","../src/useTrackVisibility.ts"],"sourcesContent":["import { useState, useCallback, useEffect, useRef } from 'react';\r\nimport { Omit } from './types';\r\n\r\nconst DEFAULT_ROOT_MARGIN = '0px';\r\nconst DEFAULT_THRESHOLD = [0];\r\n\r\nexport type IntersectionObserverHookArgs = Omit<\r\n  IntersectionObserverInit,\r\n  'root'\r\n>;\r\n\r\nexport type IntersectionObserverHookRefCallbackNode = Element | null;\r\n\r\nexport type IntersectionObserverHookRefCallback = (\r\n  node: IntersectionObserverHookRefCallbackNode,\r\n) => void;\r\n\r\nexport type IntersectionObserverHookRootRefCallbackNode = IntersectionObserverInit['root'];\r\n\r\nexport type IntersectionObserverHookRootRefCallback = (\r\n  node: IntersectionObserverHookRootRefCallbackNode,\r\n) => void;\r\n\r\nexport type IntersectionObserverHookResult = [\r\n  IntersectionObserverHookRefCallback,\r\n  {\r\n    entry: IntersectionObserverEntry | undefined;\r\n    rootRef: IntersectionObserverHookRootRefCallback;\r\n  },\r\n];\r\n\r\n// For more info:\r\n// https://developers.google.com/web/updates/2016/04/intersectionobserver\r\n// https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\r\nfunction useIntersectionObserver(\r\n  args?: IntersectionObserverHookArgs,\r\n): IntersectionObserverHookResult {\r\n  const rootMargin = args?.rootMargin ?? DEFAULT_ROOT_MARGIN;\r\n  const threshold = args?.threshold ?? DEFAULT_THRESHOLD;\r\n\r\n  const nodeRef = useRef<IntersectionObserverHookRefCallbackNode>(null);\r\n  const rootRef = useRef<IntersectionObserverHookRootRefCallbackNode>(null);\r\n  const observerRef = useRef<IntersectionObserver | null>(null);\r\n\r\n  const [entry, setEntry] = useState<IntersectionObserverEntry>();\r\n\r\n  const unobserve = useCallback(() => {\r\n    // Disconnect the current observer (if there is one)\r\n    const currentObserver = observerRef.current;\r\n    currentObserver?.disconnect();\r\n    observerRef.current = null;\r\n  }, []);\r\n\r\n  const observe = useCallback(() => {\r\n    const node = nodeRef.current;\r\n    if (node) {\r\n      const root = rootRef.current;\r\n      const options = { root, rootMargin, threshold };\r\n      // Create a observer for current \"node\" with given options.\r\n      const observer = new IntersectionObserver(([newEntry]) => {\r\n        setEntry(newEntry);\r\n      }, options);\r\n      observer.observe(node);\r\n      observerRef.current = observer;\r\n    }\r\n  }, [rootMargin, threshold]);\r\n\r\n  const initializeObserver = useCallback(() => {\r\n    unobserve();\r\n    observe();\r\n  }, [observe, unobserve]);\r\n\r\n  const refCallback = useCallback<IntersectionObserverHookRefCallback>(\r\n    (node) => {\r\n      nodeRef.current = node;\r\n      initializeObserver();\r\n    },\r\n    [initializeObserver],\r\n  );\r\n\r\n  const rootRefCallback = useCallback<IntersectionObserverHookRootRefCallback>(\r\n    (rootNode) => {\r\n      rootRef.current = rootNode;\r\n      initializeObserver();\r\n    },\r\n    [initializeObserver],\r\n  );\r\n\r\n  useEffect(() => {\r\n    // After React 18, StrictMode unmounts and mounts components to be sure\r\n    // if they are resilient effects being mounted and destroyed multiple times.\r\n    // This a behavior to be sure nothing breaks when off-screen components\r\n    // can preserve their state with future React versions.\r\n    // So in StrictMode, React unmounts the component, clean-up of this useEffect gets triggered and\r\n    // we stop observing the node. But we need to start observing after component re-mounts with its preserved state.\r\n    // So to handle this case, we call initializeObserver here.\r\n    // https://reactjs.org/blog/2022/03/08/react-18-upgrade-guide.html#updates-to-strict-mode\r\n    initializeObserver();\r\n    return () => {\r\n      // We disconnect the observer on unmount to prevent memory leaks etc.\r\n      unobserve();\r\n    };\r\n  }, [initializeObserver, unobserve]);\r\n\r\n  return [refCallback, { entry, rootRef: rootRefCallback }];\r\n}\r\n\r\nexport default useIntersectionObserver;\r\n","import { useState } from 'react';\r\nimport useIntersectionObserver, {\r\n  IntersectionObserverHookArgs,\r\n  IntersectionObserverHookResult,\r\n} from './useIntersectionObserver';\r\n\r\nexport type TrackVisibilityHookArgs = IntersectionObserverHookArgs;\r\n\r\nexport type TrackVisibilityHookResult = [\r\n  IntersectionObserverHookResult[0],\r\n  IntersectionObserverHookResult[1] & {\r\n    isVisible: boolean;\r\n    wasEverVisible: boolean;\r\n  },\r\n];\r\n\r\nfunction useTrackVisibility(\r\n  args?: IntersectionObserverHookArgs,\r\n): TrackVisibilityHookResult {\r\n  const [ref, result] = useIntersectionObserver(args);\r\n  const isVisible = Boolean(result.entry?.isIntersecting);\r\n  const [wasEverVisible, setWasEverVisible] = useState(isVisible);\r\n\r\n  if (isVisible && !wasEverVisible) {\r\n    setWasEverVisible(true);\r\n  }\r\n\r\n  return [ref, { ...result, isVisible, wasEverVisible }];\r\n}\r\n\r\nexport default useTrackVisibility;\r\n"],"names":["DEFAULT_THRESHOLD","useIntersectionObserver","args","rootMargin","threshold","nodeRef","useRef","rootRef","observerRef","useState","entry","setEntry","unobserve","useCallback","currentObserver","current","disconnect","observe","node","observer","IntersectionObserver","root","initializeObserver","refCallback","rootRefCallback","rootNode","useEffect","ref","result","isVisible","Boolean","_result$entry","isIntersecting","wasEverVisible","setWasEverVisible"],"mappings":"2FAIMA,EAAoB,CAAC,GA8B3B,SAASC,EACPC,WAEMC,iBAAaD,SAAAA,EAAMC,cAlCC,MAmCpBC,iBAAYF,SAAAA,EAAME,aAAaJ,EAE/BK,EAAUC,SAAgD,MAC1DC,EAAUD,SAAoD,MAC9DE,EAAcF,SAAoC,QAE9BG,aAAnBC,OAAOC,OAERC,EAAYC,eAAY,eAEtBC,EAAkBN,EAAYO,cACpCD,GAAAA,EAAiBE,aACjBR,EAAYO,QAAU,OACrB,IAEGE,EAAUJ,eAAY,eACpBK,EAAOb,EAAQU,WACjBG,EAAM,KAIFC,EAAW,IAAIC,sBAAqB,YACxCT,UAHc,CAAEU,KADLd,EAAQQ,QACGZ,WAAAA,EAAYC,UAAAA,IAKpCe,EAASF,QAAQC,GACjBV,EAAYO,QAAUI,KAEvB,CAAChB,EAAYC,IAEVkB,EAAqBT,eAAY,WACrCD,IACAK,MACC,CAACA,EAASL,IAEPW,EAAcV,eAClB,SAACK,GACCb,EAAQU,QAAUG,EAClBI,MAEF,CAACA,IAGGE,EAAkBX,eACtB,SAACY,GACClB,EAAQQ,QAAUU,EAClBH,MAEF,CAACA,WAGHI,aAAU,kBASRJ,IACO,WAELV,OAED,CAACU,EAAoBV,IAEjB,CAACW,EAAa,CAAEb,MAAAA,EAAOH,QAASiB,gRCxFzC,SACEtB,WAEsBD,EAAwBC,GAAvCyB,OAAKC,OACNC,EAAYC,iBAAQF,EAAOlB,cAAPqB,EAAcC,kBACIvB,WAASoB,GAA9CI,cAEHJ,IAAcI,IAChBC,SAAkB,GAGb,CAACP,OAAUC,GAAQC,UAAAA,EAAWI,eAAAA"}